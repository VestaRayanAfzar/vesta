# vesta
**[Vesta Rayan Afzar](http://vestarayanafzar.com) Platform**

## Installation
    npm install -g vesta
**Attention:** For full application lifecycle management (source control, deploy, and backup) the Docker (engine & compose) must be installed.  


## Technologies and Frameworks
* Docker
* Git
* CommonJS
* ExpressJS
* React
* TypeScript
* Sass
* Gulp
* Webpack
* Cordova
* Electron

## Commands

### `vesta init`
This command is used to initiate your dedicated server or VPS by (**Ubuntu**):
* `vesta init docker`: Installing docker engine
* `vesta init docker-compose`: Installing docker-compose

### `vesta create`
This command will create a project using below scaffolding templates and the options you provide [use `vesta create --help`]:
* Server side
  * [Express REST Api](https://github.com/hbtb/vesta-template-api) RESTfull backend on Express framework
* Client side
  * [Client Application](https://github.com/hbtb/material-template-client) This project contains build process for any of Web, Cordova, Electron targets
  * [Admin Panel](https://github.com/hbtb/material-template-admin) Same as client project but specifically coded for control panels

All these project are common in some files which are exported to a new project ([commonCodeTemplate](https://github.com/hbtb/vesta-template-cmn)) 
which will be copied/submoduled  into a sub directory of generated project.

If you want to init git repository you have to create them on your remote git repository server before using `vesta create`. 
The most important repository is the commonCode repository. 

### `vesta gen`
Generate each of the below items  [use `vesta gen --help`]:
* **sass** `vesta gen sass (font|component|directive|page) name`
* **model** `vesta gen model name` Creates a model step by step by asking several questions
* **controller** `vesta gen controller name` Based on the type of project this will generate a server side (express) or 
    client side (angular) controller
* **directive** `vesta gen directive name` Generates an angular directive
* **filter** `vesta gen filter name` Generates an angular filter

For getting help on any of the above items you may use `vesta gen <item> --help`

### `vesta update`
This command will update all `vesta-*` packages that are installed in your project and listed in `package.json`
* `vesta update` will only update all vesta packages
* `vesta update --all` will update all packages mentioned at `dependencies` 
* `vesta update --dev` will update all packages mentioned at `devDependencies` 

### `vesta deploy (httpGitRepository | previousDeployConfigFile) [ext params]`<sup>1</sup>
After asking `username` and `password` the deploy process starts.
Deploy process Will move `resources/ci/deploy.sh` file to the project's root directory and  execute it.
These npm modules should be installed globally on the deploy server: `gulp-cli`,`typescript`.

Any `ext params` of any kind provided to the commend will be passed to `deploy.sh` script respectively after `CLONE_PATH` and `DEPLOY_PATH`,
 so it will be like `/path/to/deploy.sh CLONE_PATH DEPLY_PATH ext params`

### `vesta docker COMMAND [options...] [PATH]` 
**Manage docker relevant operations**
* COMMAND
  * `clean` Removes all orphan volumes and networks. And also images without name
  * `ps ` Displays the relevant containers info of specified PATH
  * `up` Executes `docker compose up -d` on the path specified by PATH.
        The PATH is the name of the file generated by `vesta deploy`.
        If no PATH is mentioned, vesta will look for 'docker-compose.yml' file
  * `down` Executes `docker compose down` on the path specified by PATH
  * `scale` Executes 'docker compose scale' on the path specified by PATH.
        This command will only scale the 'api' container of the specific project. Then vesta will obtain
         the new container's ip and port and updates the upstream section of nginx configuration file.
         You still need to restart the loaBalancer/reverseProxy service manually for the changes to take effect

### `vesta backup [previousDeployConfigFile]`
This will mount all volumes of this project into a _busybox_ image and then export (`docker export`) them into a tar file 
named `backup_yyyymmdd-hhmmss.tar`. The container will be removed after all.   

If `vesta backup` command is used (without any fileName), the vesta will look for `docker-compose.yml` file in current 
directory. If it's found based on the volumes on the compose file the backup tar file will be created, otherwise it will
log an error.

_**WARNING!**_ mount volumes will be merged into a single `busybox` container, so if there are more than one directory with
the same path -even different- inside containers, they will be merged together. 

1) `previousDeployConfigFile` is the path to the json file generated by `vesta deploy` command